import '../support/index';
/// <reference types="./../support/index.d.ts" />
describe('execute sqlmap in different ways', () => {
  beforeEach(() => {
    cy.visit('/#/login') // #/form/new-
  })
  it('should execute sqlmap from test file', () => {
    // execute sqlmap from cypress test specification
    cy.sqlMap({ route: 'http://localhost:3000/rest/products/search?q=', args: [' --dbs --level=3 --risk=3 --batch'] })
    cy.sqlMap({ route: 'http://localhost:3000/rest/products/search?q=', args: [' --schema'] }) // --batch?
    // cy.task('SQLInject', {route: '/rest/products/search', args: [--x --y --z], query_params: [username, password], api_param='GET', })
    // cy.task('SQLInject', {route: '/rest/users/login/', args: [--x --y --z], query_params: [username, password], api_param='GET', })

    // cy.sqlInject({ route: 'http://localhost:3000/rest/products/search?q=', args: [' --dbs --level=3 --risk=3 --batch'] })
  })

  it('should test an endpoint for sql injection', () => {
    // modify the request!!!
    cy.intercept('POST', 'http://localhost:3000/rest/user/login').as('interceptedRequest')
    cy.get('.close-dialog').click()
    cy.get('#email').type("' or 1=1--")
    cy.get('#password').type('a')
    cy.get('#loginButton').click()
    // cy.wait('@interceptedLogin') // waits for login request to be intercepted
    // cy.get('input.my-cool-formclass').sho

    cy.wait('@interceptedRequest').then((request) => {
      console.log(request)
      const method = 'POST'
      const postParams = ['email', 'password']
      console.log(postParams)
      // const expectedStatus = 200
      const endpoint = 'http://127.0.0.1:3000/rest/user/login/'
      cy.checkEndpoint(request, method, endpoint, postParams)
      // cy.task('checkEndpoint', {request, method, endpoint, postParams})// -> this works!!!! YYYYYYYYYYY
      // cy.task('AnalyseRequests', request)
      // method, params/body
    })
  })
  it('should test for sqli using the header', () => {
    cy.intercept('POST', 'http://localhost:3000/rest/user/login').as('interceptedLogin')
    cy.get('.close-dialog').click()
    cy.get('#email').type('baran@bb.com')
    cy.get('#password').type('aaaa')
    cy.get('#loginButton').click()
    // cy.wait('@interceptedLogin') // waits for login request to be intercepted
    cy.wait('@interceptedLogin').then((request) => {
      const headers = ['cookie', 'x-forwarded-for', 'user-agent']
      // const values = ['xxx', 'yyy', 'zzz']
      // cy.task('HeaderSQLi', { request, headers })
      cy.headerSQLi(request, headers)
      // cy.task('AnalyseRequests', request)
      // method, params/body
    })
  })
  it('should test an input field for XSS', () => {
    cy.visit('https://brokencrystals.com/')
    cy.get('').type('');
    cy.intercept('GET', 'https://brokencrystals.com/api/subscriptions*').as('interceptedRequest')
    cy.wait('@interceptedRequest').then((request) => {
      // cy.task('reflectedXSS', {request})
      cy.reflectedXSS(request);
    })
  })
})
